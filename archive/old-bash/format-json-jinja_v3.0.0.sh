#!/bin/bash

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# JSON+Jinja2 Formatter v3.0.0 - Smart Auto-Fix Edition
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#
# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: format-json-jinja_v3.0.0.sh <file>
#
# Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ v3.0.0:
# âœ… Ğ’ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğ¹ SmartJSONFixer (Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ñ… Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹)
# âœ… ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ 6+ Ñ‚Ğ¸Ğ¿Ğ¾Ğ² Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº:
#    - ĞŸÑ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿ÑÑ‚Ñ‹Ğµ Ğ¿Ğ¾ÑĞ»Ğµ } Ğ¸ ]
#    - Trailing Ğ·Ğ°Ğ¿ÑÑ‚Ñ‹Ğµ
#    - Ğ”ÑƒĞ±Ğ»Ğ¸Ñ€ÑƒÑÑ‰Ğ¸ĞµÑÑ Ğ·Ğ°Ğ¿ÑÑ‚Ñ‹Ğµ
#    - Ğ¡Ğ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ğ±ĞµĞ· ĞºĞ°Ğ²Ñ‹Ñ‡ĞµĞº
#    - ĞĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸
# âœ… Ğ ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğµ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¼ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸ĞµĞ¼
# âœ… Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹
# âœ… Graceful error handling (Ğ½Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² VSCode)
#
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

set -e

FILE="$1"

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Ğ’ĞĞ›Ğ˜Ğ”ĞĞ¦Ğ˜Ğ¯ Ğ’Ğ¥ĞĞ”ĞĞ«Ğ¥ Ğ”ĞĞĞĞ«Ğ¥
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

if [ -z "$FILE" ]; then
    echo "Usage: $0 <file>" >&2
    exit 1
fi

if [ ! -f "$FILE" ]; then
    echo "File not found: $FILE" >&2
    exit 1
fi

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# ĞšĞĞĞ¤Ğ˜Ğ“Ğ£Ğ ĞĞ¦Ğ˜Ğ¯
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# ĞŸÑƒÑ‚ÑŒ Ğº Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‚ĞµÑ€Ñƒ (Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµÑ‚ÑÑ Ğ² Ñ‚Ğ¾Ğ¹ Ğ¶Ğµ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸)
FORMATTER_DIR="$(dirname "$0")"
FORMATTER="$FORMATTER_DIR/../Documents/FMS_GIT/.vscode/jinja-json-formatter.js"

# Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ´Ğ»Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ¸ Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ²
BACKUP="${FILE}.backup.$(date +%Y%m%d_%H%M%S)"
FIX_LOG="/tmp/json_fixes_$(basename "$FILE")_$(date +%s).log"
TEMP_FILE=$(mktemp)

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

cleanup() {
    rm -f "$TEMP_FILE"
}
trap cleanup EXIT

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Ğ­Ğ¢ĞĞŸ 0: Ğ Ğ•Ğ—Ğ•Ğ Ğ’ĞĞĞ• ĞšĞĞŸĞ˜Ğ ĞĞ’ĞĞĞ˜Ğ•
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

cp "$FILE" "$BACKUP"
echo "2025-10-05 $(date +%H:%M:%S) - INFO - ğŸ“¦ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ° Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ°Ñ ĞºĞ¾Ğ¿Ğ¸Ñ: $BACKUP"

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Ğ­Ğ¢ĞĞŸ 1: ĞĞ’Ğ¢ĞĞœĞĞ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ• Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ¯ (Ğ’Ğ¡Ğ¢Ğ ĞĞ•ĞĞĞ«Ğ™ SmartJSONFixer)
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

echo "2025-10-05 $(date +%H:%M:%S) - INFO - ğŸ”§ ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ..."

python3 - "$FILE" "$FIX_LOG" << 'PYTHON_EOF'
#!/usr/bin/env python3
"""Ğ’ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğ¹ SmartJSONFixer Ğ´Ğ»Ñ format-json-jinja v3.0.0"""
import sys
import re
from pathlib import Path

class SmartJSONFixer:
    """Ğ˜Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ„Ğ¸ĞºÑĞµÑ€ JSON ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸ÑĞ°"""

    def __init__(self):
        self.fixes = []

    def fix_missing_comma_after_brace(self, content: str) -> str:
        """Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ } \n "property" â†’ }, \n "property" """
        lines = content.split('\n')
        result = []

        for i, line in enumerate(lines):
            line_num = i + 1
            stripped = line.strip()

            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼: } Ğ² ĞºĞ¾Ğ½Ñ†Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸, ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ°Ñ Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑ‚ÑÑ Ñ "
            if stripped.endswith('}') and i + 1 < len(lines):
                next_line = lines[i + 1].strip()
                if next_line and next_line.startswith('"') and ':' in next_line:
                    if not stripped.endswith(',}'):
                        self.fixes.append(f"Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ° {line_num}: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° Ğ·Ğ°Ğ¿ÑÑ‚Ğ°Ñ Ğ¿Ğ¾ÑĞ»Ğµ '}}' Ğ¿ĞµÑ€ĞµĞ´ {next_line[:20]}...")
                        line = line.rstrip('}') + '},'

            result.append(line)

        return '\n'.join(result)

    def fix_missing_comma_after_bracket(self, content: str) -> str:
        """Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ] \n { â†’ ], \n { """
        lines = content.split('\n')
        result = []

        for i, line in enumerate(lines):
            line_num = i + 1
            stripped = line.strip()

            if stripped.endswith(']') and i + 1 < len(lines):
                next_line = lines[i + 1].strip()
                if next_line and (next_line.startswith('{') or next_line.startswith('"')):
                    if not stripped.endswith(',]'):
                        self.fixes.append(f"Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ° {line_num}: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° Ğ·Ğ°Ğ¿ÑÑ‚Ğ°Ñ Ğ¿Ğ¾ÑĞ»Ğµ ']'")
                        line = line.rstrip(']') + '],'

            result.append(line)

        return '\n'.join(result)

    def fix_trailing_commas(self, content: str) -> str:
        """Ğ£Ğ´Ğ°Ğ»ÑĞµÑ‚ trailing Ğ·Ğ°Ğ¿ÑÑ‚Ñ‹Ğµ Ğ¿ĞµÑ€ĞµĞ´ } Ğ¸ ]"""
        original = content
        content = re.sub(r',(\s*)\}', r'\1}', content)
        content = re.sub(r',(\s*)\]', r'\1]', content)
        if content != original:
            self.fixes.append("Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ñ‹ trailing Ğ·Ğ°Ğ¿ÑÑ‚Ñ‹Ğµ")
        return content

    def fix_duplicate_commas(self, content: str) -> str:
        """Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ,, â†’ ,"""
        lines = content.split('\n')
        result = []

        for i, line in enumerate(lines):
            line_num = i + 1
            original = line
            while re.search(r',\s*,', line):
                line = re.sub(r',\s*,', ',', line)
            if line != original:
                self.fixes.append(f"Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ° {line_num}: Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ñ‹ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€ÑƒÑÑ‰Ğ¸ĞµÑÑ Ğ·Ğ°Ğ¿ÑÑ‚Ñ‹Ğµ")
            result.append(line)

        return '\n'.join(result)

    def fix_invalid_comments(self, content: str) -> str:
        """Ğ£Ğ´Ğ°Ğ»ÑĞµÑ‚ Ğ½ĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğµ JSON ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸ (ĞºÑ€Ğ¾Ğ¼Ğµ file:// Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ²)"""
        lines = content.split('\n')
        result = []

        for i, line in enumerate(lines):
            line_num = i + 1
            # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸ Ñ file:// (ÑÑ‚Ğ¾ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñ‹)
            if 'file://' in line and '//' in line:
                result.append(line)
                continue

            # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğµ // ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸
            if '//' in line and '"' not in line.split('//')[0]:
                clean_line = line.split('//')[0].rstrip()
                if clean_line != line.rstrip():
                    self.fixes.append(f"Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ° {line_num}: Ğ£Ğ´Ğ°Ğ»ĞµĞ½ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹")
                    line = clean_line

            result.append(line)

        return '\n'.join(result)

    def fix_json(self, content: str) -> str:
        """ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ²ÑĞµ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ"""
        content = self.fix_invalid_comments(content)
        content = self.fix_missing_comma_after_brace(content)
        content = self.fix_missing_comma_after_bracket(content)
        content = self.fix_duplicate_commas(content)
        content = self.fix_trailing_commas(content)
        return content


def main():
    if len(sys.argv) < 3:
        sys.exit(1)

    file_path = Path(sys.argv[1])
    log_path = Path(sys.argv[2])

    # Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ„Ğ°Ğ¹Ğ»
    with open(file_path, 'r', encoding='utf-8') as f:
        content = f.read()

    # ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ
    fixer = SmartJSONFixer()
    fixed_content = fixer.fix_json(content)

    # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»
    with open(file_path, 'w', encoding='utf-8') as f:
        f.write(fixed_content)

    # Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ
    if fixer.fixes:
        with open(log_path, 'w', encoding='utf-8') as f:
            for fix in fixer.fixes:
                timestamp = "2025-10-05 " + __import__('datetime').datetime.now().strftime('%H:%M:%S')
                f.write(f"{timestamp} - INFO - ğŸ”§ AUTO-FIX: {fix}\n")

if __name__ == '__main__':
    main()
PYTHON_EOF

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹
if [ -s "$FIX_LOG" ]; then
    echo "2025-10-05 $(date +%H:%M:%S) - INFO - ğŸ“‹ ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ñ‹ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ:"
    cat "$FIX_LOG"
else
    echo "2025-10-05 $(date +%H:%M:%S) - INFO - âœ“ Ğ¡Ğ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ½Ğµ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¾"
fi

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Ğ­Ğ¢ĞĞŸ 2: Ğ¤ĞĞ ĞœĞĞ¢Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ•
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

echo "2025-10-05 $(date +%H:%M:%S) - INFO - âœ¨ Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒÑ JSON+Jinja2..."

# ĞŸÑ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ¾Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»
if [ -f "$FORMATTER" ]; then
    if node "$FORMATTER" "$FILE" > "$TEMP_FILE" 2>/dev/null; then
        # Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾
        mv "$TEMP_FILE" "$FILE"
        echo "2025-10-05 $(date +%H:%M:%S) - INFO - âœ“ Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾: $FILE"

        # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½ÑƒÑ ĞºĞ¾Ğ¿Ğ¸Ñ
        rm -f "$BACKUP"

        # Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°
        if [ -s "$FIX_LOG" ]; then
            echo ""
            echo "2025-10-05 $(date +%H:%M:%S) - INFO - ğŸ“Š Ğ˜Ñ‚Ğ¾Ğ³Ğ¾ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹: $(wc -l < "$FIX_LOG" | tr -d ' ')"
        fi

        exit 0
    else
        # Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ
        echo "2025-10-05 $(date +%H:%M:%S) - WARNING - âš ï¸ Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ´Ğ°Ğ¶Ğµ Ğ¿Ğ¾ÑĞ»Ğµ Ğ°Ğ²Ñ‚Ğ¾Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹" >&2
    fi
else
    echo "2025-10-05 $(date +%H:%M:%S) - WARNING - âš ï¸ Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‚ĞµÑ€ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½: $FORMATTER" >&2
fi

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Ğ’ĞĞ¡Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ• ĞŸĞ Ğ˜ ĞĞ¨Ğ˜Ğ‘ĞšĞ•
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¸Ğ· Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸
if [ -f "$BACKUP" ]; then
    mv "$BACKUP" "$FILE"
    echo "2025-10-05 $(date +%H:%M:%S) - INFO - ğŸ“¦ Ğ¤Ğ°Ğ¹Ğ» Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ¸Ğ· Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸" >&2
fi

if [ -s "$FIX_LOG" ]; then
    echo "2025-10-05 $(date +%H:%M:%S) - INFO - ğŸ“„ Ğ›Ğ¾Ğ³ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½: $FIX_LOG" >&2
fi

# ĞĞµ Ğ¿Ğ°Ğ´Ğ°ĞµĞ¼ Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¾Ğ¹, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² VSCode
exit 0
