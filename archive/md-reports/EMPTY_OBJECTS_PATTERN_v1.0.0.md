# Паттерн пустых объектов в SDUI контрактах

**Версия:** 1.0.0  
**Дата:** 2025-01-07

## Обзор

В SDUI контрактах пустые объекты `{}` являются **валидным и намеренным паттерном**, который несет семантическую нагрузку.

## Ключевое различие

```json
// Вариант 1: Поле отсутствует
{
  "type": "Spacer",
  "size": { "height": 30 }
}

// Вариант 2: Поле присутствует, но пустое
{
  "type": "Spacer",
  "size": { "height": 4 },
  "content": {},
  "hidden": false,
  "version": 1
}
```

**Семантика:**
- **Отсутствие поля**: поле не применимо или используется значение по умолчанию
- **Пустой объект `{}`**: поле применимо, но явно пустое (нет содержимого)

## Реальные примеры из продакшна

### 1. Spacer без содержимого

```json
{
  "type": "Spacer",
  "size": { "height": 4 },
  "content": {},        // Явно указываем отсутствие содержимого
  "hidden": false,
  "version": 1
}
```

**Зачем нужно `content: {}`?**
- Парсер на клиенте может требовать обязательное поле `content`
- Отсутствие поля может вызвать ошибку десериализации
- Пустой объект явно указывает "содержимое намеренно отсутствует"

### 2. Button с пустыми параметрами

```json
{
  "type": "Button",
  "content": {
    "title": "Нажми меня",
    "params": {}        // Параметры по умолчанию
  }
}
```

### 3. Container с пустым data

```json
{
  "type": "Container",
  "content": {
    "children": [...],
    "data": {}          // Нет дополнительных данных
  }
}
```

## Почему это важно для парсера

### ❌ Неправильное поведение

```javascript
// ПЛОХО: Удаление пустых объектов
function cleanEmptyObjects(obj) {
  if (typeof obj === 'object') {
    for (const key in obj) {
      if (obj[key] && Object.keys(obj[key]).length === 0) {
        delete obj[key];  // ❌ Удаляет семантически важное поле!
      }
    }
  }
}
```

### ✅ Правильное поведение

```javascript
// ХОРОШО: Сохранение пустых объектов
function substitute(obj, context) {
  if (typeof obj === 'object') {
    const newObj = {};
    for (const key in obj) {
      newObj[key] = substitute(obj[key], context);
      // Пустые объекты {} сохраняются как есть
    }
    return newObj;
  }
  return obj;
}
```

## Тестирование

Парсер проверяется на корректную обработку пустых объектов:

```bash
node /Users/username/Scripts/tests/test_empty_objects_v1.0.0.js
```

**Результаты:** 5/5 тестов пройдено ✅

## Использование в computed_data_parser_v2.js

Парсер **корректно обрабатывает** пустые объекты:

```javascript
const input = {
  type: "Spacer",
  content: {},
  hidden: false
};

const result = substitute(input, context);

// result сохраняет структуру:
// {
//   "type": "Spacer",
//   "content": {},
//   "hidden": false
// }
```

## Статистика из продакшн контракта

**Файл:** `[FULL_NN]_main-screen_v3_Android_web.json`

- Всего Spacer компонентов: **46**
- С пустым `content: {}`: **20** (43%)
- Без поля `content`: **26** (57%)

## Best Practices

### ✅ Рекомендуется

1. **Сохранять пустые объекты** при обработке контрактов
2. **Различать** отсутствие поля и пустое поле
3. **Тестировать** парсер на реальных продакшн данных

### ❌ Не рекомендуется

1. Удалять пустые объекты при "оптимизации"
2. Считать `content: {}` эквивалентным отсутствию `content`
3. Минифицировать контракты без учета семантики

## JSON Schema validation

Если используется JSON Schema, пустые объекты должны быть валидны:

```json
{
  "type": "object",
  "properties": {
    "content": {
      "type": "object",
      "default": {}
    }
  }
}
```

## Дальнейшее развитие

- [ ] Добавить линтер для проверки корректности пустых объектов
- [ ] Документировать все случаи использования пустых объектов
- [ ] Создать миграционный гайд для legacy контрактов

## Ссылки

- Тесты: `/Users/username/Scripts/tests/test_empty_objects_v1.0.0.js`
- Парсер: `/Users/username/Scripts/computed_data_parser_v2.js` (строки 124-133)
- Продакшн контракт: `[FULL_NN]_main-screen_v3_Android_web.json`

---

**Важно:** Пустые объекты `{}` - это **не баг**, а **feature** SDUI контрактов!
